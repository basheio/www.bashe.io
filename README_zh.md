www.bashe.io 官方网站源文件，如果需要重新搭建请将其上传到亚马逊云，使用S3和cloudfront。

按照以下指南操作：

## I 云服务部署

### part 1 注册亚马逊云，并进行域名验证

您可以使用 `亚马逊云AWS` https://aws.amazon.com 或其它提供商提供的云计算服务和对象存储系统，这里我们使用AWS的`S3`和`CloudFront`为例。
**进阶了解**：`S3`即Simple Storage Service，是亚马逊云的简单存储服务，用来在AWS的全球存储区域网络存放页面资源，`CloudFront`是亚马逊云的内容发布服务，即把页面资源部署到亚马逊云提供的存储服务后，当用户使用CloudFront URL来请求静态内容时，该服务就会根据发出请求的IP以及缓存这一内容的数据中心的位置来找到距离这个IP最近的边缘加速节点数据中心，这样所有来自于相同位置的请求就会减少延迟时间。全球任何一个地方的用户拉取您的页面资源速度更快，体验较好。

1. 注册AWS账户：https://portal.aws.amazon.com/billing/signup 在`付款信息`一页需要填入真实的信用卡信息，用于账户验证，此后的支持计划选免费的即可，AWS许多资源都是免费的，超量使用了资源才会收取费用，例如此指南中示例的5G以内S3、CloudFront存储都是免费用12个月。

完成以后可以登录控制台：https://console.aws.amazon.com/ 在控制台右上角显示的默认区域是`俄亥俄`，点击以切换为`新加坡`等其他想要的区域。

2. 因为您可能需要为`S3`和`CloudFront`绑定自己的域名，所以建议先进行耗时较长的域名验证以方便之后的步骤流畅部署。为此域名申请证书：https://cconsole.aws.amazon.com/acm 

    a. 首先点击右上角区域，切换为`弗吉尼亚北部`。只有此区域申请的证书可以与稍后的`CloudFront`联合使用。
    b. 点击`请求证书`- `请求公有证书`,点击`请求证书`,`添加域名`中输入您的域名，这里可以点击添加，为证书指定多个可能要用的域名，`下一步`，`DNS 验证`，`下一步`，`审核`，`确认并请求`。
    c. 点击`验证`-`域`下方的`▶`，展开ACM验证内容，将 CNAME 记录添加到域的 DNS 配置中（DNS配置方式见part2）。例如显示的`_30a086xxxxxxxx3c4448f11ad7.www.example.org.`中，仅需要将前面的`_30a086xxxxxxxx3c4448f11ad7.www`填入域名DNS的`子域名`中，`记录类型`选择`CNAME`，`IP地址/目标主机`填写ACM验证内容中的值，例如`_b985b312234xxxxxxxf20dfdb.mzlfeqexyx.acm-validations.aws`保存cname后需要等待一段时间，生效以后ACM才能自动进行验证。
    d. 验证完成以后，状态会变更为`已颁发`，证书就可以使用了。现在，您可以将区域切换为您想用的其他区域。

    **进阶了解**：www.example.org为子域名，example.org为根域名。因为要使用CNAME，大多数的域名服务商不支持根域名CNAME，或者不能同时使用根域名MX和NAME：example.org的形式，因此以上步骤中只能在子域名中填写`_30a086xxxxxxxx3c4448f11ad7.www`用于验证，这样ACM访问`_30a086xxxxxxxx3c4448f11ad7.www.example.org`只要能获取到`_b985b312234xxxxxxxf20dfdb.mzlfeqexyx.acm-validations.aws`值就能证明您拥有此域名。
    
### part2 域名注册和域名解析（DNS设置）

在此，我们以dynadot.com 为例介绍如何设置域名DNS，以解析域名到云服务。

进入https://www.dynadot.com `登陆`或`注册`。

1. 如果已有域名跳过此步骤，如果需要注册新域名，点击右上角`域名`-`搜索`，输入您要用的域名搜索，如果可用，`加购物车`，点击右上角`购物车图标`-`view cart`，在购物车页面选择注册时限，最好时间长一点并且设置闹钟，万一忘了续费域名是会被删除的。设好以后点击`check out`。`Payment Method`可以选择paypal之类的付款方式，如果将右上角计费方式选为CNY，还可以使用支付宝和微信付款，点击`submit order`，会生成付款链接，点击弹出二维码，扫描付款即可。

2. 如果已有域名，在https://www.dynadot.com/zh/account/ 页点击`我的域名`-`管理域名`，点击`DNS设置`下方的链接（可能显示`域名停靠`或`Dynadot DNS:XXX`），进入DNS设置页，新域名默认会显示`域名停靠`，点击下拉菜单，选择`自定义DNS`。
    a. `域名记录（必填）`中，是example.com的记录，最常用的是`A`记录类型，将记录类型选为`A`，`IP地址/目标主机`填写您的服务器IP即可将example.com指向您的服务器，再在服务器进行nginx或apache配置等即可实现网站访问；
    
    b. 如果要将子域名指向AWS CloudFront等，则在 `域名记录（必填）`中，将记录类型选为`CNAME`，`IP地址/目标主机`填写AWS分配的域名，即可实现自定义域名，如果您需要同时使用邮箱自定义域名MX，则不能对根域名设置CNAME，可以考虑使用设置www子域名CNAME，然后使用以下两种方法进行根域名转发：(1)将根域名A记录到一台服务器IP，在该服务器进行域名转发，(2)在DNS中使用`forward 301` 到`http://www.example.com`；
    
    c. 在这里还可以填入MX进行邮箱配置，TXT进行域名验证等操作；
    
    d. `子域名记录（可选）`中是填入您要用的子域名，例如www.example.com便是子域名，将`www`填入`子域名`一栏，将记录类型选为`A`或`CNAME`，`IP地址/目标主机`填写您的服务器IP即可将www.example.com指向您的服务器；
    
    e. 在申请证书之类的域名验证场景中，可以根据是否有子域名来决定填写什么样的信息到`子域名`一栏；
    
    f. 子域名指向AWS CloudFront等服务也是使用`CNAME`记录，操作方式和根域名一致，只是前面加了子域名而已。
    
    g. 配置完成后点击`保存DNS`，等待生效即可，生效时间需要几分钟到几十分钟不等。

以上，服务器部署准备工作完成。

## II 部署页面资源到S3，启用CloudFront

1. 首先，我们部署一个S3，用于之后的存储部署好的钱包页面资源，点击AWS左上角`服务`-`存储`-`S3`，打开`S3存储桶`，点击`创建存储桶`。
    a. 在`名称和区域`页，`存储桶名称`中输入您要建立的网站域名或二级域名，`区域`选择您想存放此资源的数据中心位置，`下一步`，配置选项默认即可，也可以根据需求修改，在`设置权限`中，取消勾选`阻止全部公共访问权限`，这样页面资源才能被公网用户访问，`下一步`，点击`创建存储桶`。
    
    b. 完成后，在`S3存储桶`首页列表中，可以看到您创建的存储桶，点击进入，点击`属性`-`静态网站托管`-`使用此存储桶托管网站`，`索引文档`、`错误文档`全部填入`index.html`,`保存`。
    
    c. 此时已可以上传静态页面资源，点击此存储桶`概述`中的`上传`，全选页面资源根目录下所有文件进入`上传`页，然后点击`下一步`，在`设置权限`-`管理公共权限`中选择`为此对象授予公共读取访问权限`，`下一步`，`存储类别`选择`标准`即可，`下一步`，`上传`。   
    
    d. 此时，您上传的页面已经可以通过外部访问，`属性`-`静态网站托管`，`终端节点`中显示的链接即页面资源通过外部访问的链接。但S3中的资源现在还只能用AWS提供的域名访问，如果要用您自己的域名来访问，需要对域名DNS设置CNAME解析到`属性`-`静态网站托管`，`终端节点`中显示的链接，而且根据您选择的数据中心区域和访问者所在地网络政策，此链接也可能在部分地区无法访问或访问速度较慢，所以我们还需要为此存储桶启用CloudFront进行全球内容发布服务。

2. 为此S3存储桶启用CloudFront，点击AWS左上角`服务`-`联网和内容分发存储`-`CloudFront`，打开`CloudFront 分配`，点击`创建分配`。
    a. `选择内容分发方式`中选择 `web - 入门`，`创建分配`中，`源域名`下拉菜单中选择您的S3存储桶名称，`默认根对象`中填入`en/index.html`，`查看器协议策略`中选择`将 HTTP 重定向到 HTTPS`，`备用域名(CNAMEs)`中填入您的域名（前提是已预先在第`第II章 part2-2`中成功申请证书），`SSL 证书`选择`自定义 SSL 证书 (example.com)`，并在下方输入框中下拉菜单选择`第I章 part1-2`中申请的证书。其它默认即可，点击`创建分配`。此时，`CloudFront 分配`页面已经出现您设置的新分配，并且分配了一个`*.cloudfront.net`的域名，使用此域名在浏览器打开，AWS会自动根据请求的来源来选择最近的数据中心。
    
    b. 现在我们绑定域名，进入您的域名DNS管理面板，在域名DNS的`子域名记录`中填入您的子域名，`记录类型`选择`CNAME`，`IP地址/目标主机`填写上一步中生成的`*.cloudfront.net`域名。如果您使用根域名，则仅需要在`域名记录`中`记录类型`选择`CNAME`，`IP地址/目标主机`填写上一步中生成的`*.cloudfront.net`即可。（DNS配置方式见第I章 part2），设置完成后，会需要等待DNS生效，生效后，访问您的域名，便不再提示`无法访问此网站`,而是进入了和`*.cloudfront.net`相同的页面，配置成功。
    
    c. 需要提醒的是CloudFront的每次修改都会需要同步到全球所有数据中心，所以需要一定的时间，修改以后没有立即生效不要急，等几分钟就好了。


生效后，您可以使用您的域名在浏览器中打开，至此，一个配置好全球内容分发的网页已经配置完成。
